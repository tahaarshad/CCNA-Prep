# Open Shortest Path First
Configure and verify single area OSPFv2
3.4.a Neighbor adjacencies
3.4.b Point-to-point
3.4.c Broadcast (DR/BDR selection)
3.4.d Router ID

## OSPF Concept

Improvement over ***RIP protocol that does not only use the hop count to decide the best possible path to transfer packets***.

__Some characteristics of OSPF:__
__Link-state protocol:__ ***Networks are divided into domains known as areas for updating routing traffic***. Interfaces on routers are known as Links. So are network segments. **Information on these links is called link-state. this includes network prefix, prefix length and cost.**

__Interior Gateway Protocol:__ Designed to be used withing a single automonous system such as an organization with multiple departments.

__Classless:__ Classless networks include subnet masks in their routing updates. Classful do not as they all are in the same subnet.

__Cost of Path depends on Bandwidth:__ uses formula ***cost = reference bandwidth/interface bandwidth***
All values less than 1 will be converted to 1.
The command is entered in megabits per 
second (default is 100)


other: 

***Shortest Path First Algorithm or Dijkstra algorithm***
- Builds topological map
- Event-driven updates
- Hierarchical design
- Requires ***additional memory, CPU processing, and more initial bandwidth than other protocols***

## Component

5 types of packets are exchanged:
- Hello - Type 1
- Database Description - Type 2
- LS Request - Type 3
- LS Update - Type 4
- LS Ack - Type 5
  

## Databases and Tables

3 databases store 3 different tables:
- ***Adjacency DB stores neighbor table*** - contain adjacent routers. Can be viewed using show ip ospf neighbor
- ***Link State db store topology table*** - contains all routers in an area. Can be viewed using show ip ospf database. SPF algorithm is run here
- ***Routing db stores forwarding table*** - stores routes generated from the algorithm. Can be viewed using show ip route


## 5 steps to building routing table

- Establish adjacencies by sending hello packets
  - ***Cause of adjacnecy failure:***
  - area must match
  - interface must be in the same subnet
  -  OSPF process must not be shutdown
  - router ID must be unique
  - hello/dead timers must match
  - autentication settings must match
  - IP MTU settings must match
  - OSPF network type must match
- Send LS Advertisements to all nearby router
- Once every router has sent each other LSA's, then the LSDB is created
- The algorithm is exevuted
- Best route is selected

## Area

- Single Area OSPF routers exist in one domain - Area 0

- Multi Area have multiple domains with one **backbone** (Area 0). 

- **Area Border Routers** exist on the edge of each domain and have interfaces in multiple areas.

- Routers with all interfaces in the same area are called internal routers.

- An intra-area route is a route to a destination inside the same OSPF area

- An interarea route is a route to a destination in a different OSPF area

Several Advantages:
- Reduced SPF calculations
- Smaller tables
- Reduces LSU overhead

All OSPF areas must have at least one ABR connected to the backbone area.

## OSPFv3

v3 is the IPv6 equivaltent of OSPFv2 which is for IPv4. Similar characteristincs and functions.


## Important Packet Information

_LSU contains upto 11 differents LSA packets with different information such as routers, network etc._

- **Type 1 (Router LSA)**
    - Every OSPF router generates this type of LSA. 
    - It identifies the router using its router ID.
    - It also lists networks attached to the router’s OSPF-activated interfaces.
- **Type 2 (Network LSA)**
    - Generated by the DR of each ‘multi-access’ network (ie. the broadcast network type).
    - Lists the routers which are attached to the multi-access network.
- **Type 5 (AS-External LSA)**
    - Generated by ASBRs to describe routes to destinations outside of the AS (OSPF domain).


Type 1 packets elect the DR and BDR. multiaccess connections like ethernet require DR and BDR but point ot point networks to do not.


## 7 OSPF States

- **Down** - no hello packets. Once packet is sent, move to init.
- **Init** - hello packet contain router id. transistion to 2 way.
- **2-way** - bidirectional communications. DR and BDR are eleced.
- **exstart** - on ptp connection, routers will decide which one will send BDB first (slave and master). Higher RID will become Master
- **exchange** - once elected, DBD is shared.
- **loading** - LSR and LSU are exchanged, SPF is run. then change to full
- **full** - fully synchronised.


### OSPF Multicast address - 224.0.0.5
### Messages to the DR/BDR are multicast using address 224.0.0.6
### Default timers: Hello 10, Dead 40
### Ruuter ID is 32 bit address similar to IPv4

## Importance of DR
Challenges:
- Flooding of LSA's
- Creation of Multiple Adjacencies

The DR will receive the LSA and flood it to others.

New DR selection occurs if:
- DR fails
- OSPF process on the DR fails
- the interface of the DR fails


## Election Process
- Highest inteface priority
- highest interface router id
- - Router ID is manually configured
- - Router ID is the highest loopback IPv4 address
- - Router ID is the highest active interface IPv4 address


### Passive Interface
The passive-interface command tells the router 
to stop sending OSPF ‘hello’ messages out of 
the interface.

## Router ID order of priority:
1) Manual configuration
2) Highest IP address on a loopback interface
3) Highest IP address on a physical interface


## The DR/BDR election order of priority:
1) Highest OSPF interface priority
2) Highest OSPF Router ID
 
_The default OSPF interface priority is 1 on all interfaces_

DROthers (R3 and R5 in this subnet) will only move to the FULL state with the DR and BDR. The neighbor state with other DROthers will be 2-way

An autonomous system boundary router (ASBR) is an OSPF router that connects the OSPF network to an external network.

There are three main OSPF network types:

***Broadcast***
- enabled by default on Ethernet and FDDI (Fiber Distributed Data Interface) interfaces

***Point-to-point***
- enabled by default on PPP (Point-to-Point Protocol) and HDLC (High-Level Data Link Control) interfaces

***Non-broadcast***
- enabled by default on Frame Relay and X.25 interfaces


## Point to Point
- Enabled on serial interfaces using the PPP or HDLC encapsulations by default.
- Routers dynamically discover neighbors by sending/listening for OSPF Hello messages using 
multicast address 224.0.0.5.
- A DR and BDR are not elected. 
- These encapsulations are used for ‘point-to-point’ connections.
- Therefore there is no point in electing a DR and BDR.
- The two routers will form a Full adjacency with each other.
- The default encapsulation is HDLC.
- You can configure PPP encapsulation with this command: 
R1(config-if)# encapsulation ppp
- One side is DCE, one side is DTE.
- Identify which side is DCE/DTE: 
R1# show controllers interface-id
- You must configure the clock rate on the DCE side:
R1(config-if)# clock rate bits-per-second


Refer to the exhibit. Why are routers R1 and R2 not able to establish an OSPF adjacency?​
On router R1, the network 192.168.10.0/30 is defined in the wrong area (area 1). It has to be defined in area 0 in order to establish adjacency with router R2, which has the network 192.168.10.0/30 defined in area 0.